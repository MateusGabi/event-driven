const io = require("socket.io-client");
const fetch = require("node-fetch");

class Microservice {
  constructor(eventBus) {
    this.eventBus = Object.assign(eventBus, {
      uri: "http://localhost",
      port: 8081
    });
    this.socket = io(`${this.eventBus.uri}:${this.eventBus.port}`);
  }

  listenEvent(event, callback) {
    this.socket.on(event, callback);
  }

  sendEvent(type, payload) {
    console.log("send event", {
      type,
      payload
    });

    fetch(`${this.eventBus.uri}:${this.eventBus.port}/publish`, {
      method: "POST",
      body: JSON.stringify({ type, payload })
    });
  }
}

module.exports = Microservice;
